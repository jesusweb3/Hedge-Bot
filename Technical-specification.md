# Hedg-Bot — Техническое задание  

## 1. Общее описание  

**Название:** Hedg-Bot  

**Цель:**  
Автоматическая торговля в режиме хеджирования с использованием тейк-профитов, стоп-лоссов и механизма доливок.  

**Биржа:**  
Bybit (бессрочные фьючерсы USDT).  

**Формат приложения:**  
Десктоп-приложение для компьютера.  

**Управление:**  
- Работа через графический интерфейс (настройки, кнопки).  
- API-ключи к бирже не отображаются в интерфейсе и не вводятся пользователем; они хранятся в файле `.env`.  

---

## 2. Основные параметры робота  

1. **Инструмент**  
   Поддерживаются только бессрочные линейные фьючерсы USDT на Bybit.  

2. **Объём входа**  
   - Фиксированная сумма в USDT.  
   - Объём одинаковый для Long и Short.  

3. **Тейк-профиты (TP)**  
   - Для каждой стороны выставляются 2 TP.
   - Выставляются лимитными ордерами
   - Параметр фиксирован, менять количество нельзя.  
   - В интерфейсе отображается информация о наличии 2 TP.  
   - Второй TP считается финальным: при его достижении закрывается вся позиция и отменяются все ордера.  

4. **Стоп-лоссы (SL)**  
   - До 10 условных стопов (ограничение биржи).
   - Выставляются условными ордерами
   - Задаются в процентах от стартового объёма и по шагу от точки входа.  
   - При срабатывании стопа часть позиции закрывается.  

5. **Доливки**  
   - Два механизма:  
     1) После того как исполняется TP1 — ставится лимитный ордер по цене ниже TP1 и заданному пользователем объёму.  
     2) После исполнения любого SL — ставится лимитный ордер в точке входа, на объём, равный закрытой части.  
   - В интерфейсе доступна галочка «Использовать доливку после TP1».  
   - Параметры доливки (цена, объём) задаются пользователем.  

6. **Плечо**  
   Пользователь настраивает плечо самостоятельно на бирже. Бот плечом не управляет.  

---

## 3. Логика работы  

### 3.1. Вход  
- Осуществляется через рыночный триггерный (условный) ордер.  
- При срабатывании одновременно открываются Long и Short.  

### 3.2. После входа  
- Сразу выставляются все TP и SL, включая финальный TP.  

### 3.3. Закрытие  
- Варианты полного закрытия позиции:  
  1. Вручную через интерфейс (с отменой всех активных ордеров).  
  2. Автоматически при достижении финального TP.  

### 3.4. Работа TP  
- TP1: закрывает часть позиции. Если включена доливка — выставляется лимитный ордер на заданный объём.  
- TP2 (финальный): закрывает всю позицию и отменяет все ордера.  

### 3.5. Работа SL  
- При достижении стопа закрывается часть позиции.  
- После срабатывания стопа в точке входа выставляется доливка на объём закрытой части.  

### 3.6. Поведение доливок  
- Доливка после TP1 закрывается либо по финальному TP, либо по SL в точке входа.  
- Если доливка закрылась по SL, объём позиции возвращается к исходному. Цикл может повторяться.  

### 3.7. Завершение сделки  
- Сделка считается завершённой, если:  
  1. Достигнут финальный TP.  
  2. Выполнено ручное закрытие через интерфейс.  

---

## 4. Интерфейс и UX  

### 4.1. Главный экран  
- Список инструментов (например, BTCUSDT, ETHUSDT и др.).  
- Возможность запускать несколько инструментов одновременно.  

### 4.2. Карточка инструмента  
Каждый инструмент отображается отдельной карточкой с вкладками:  
1. **Настройки** — параметры сделки (объём, SL, TP, доливки).  
2. **Статус / Запуск** — кнопка «Старт/Стоп», текущее состояние.  
3. **Ордеры** — список активных и отложенных ордеров.  
4. **Лог** — история действий бота.  

### 4.3. Управление позицией  
- Кнопка «Закрыть всё вручную» для полного завершения сделки по инструменту (с отменой всех ордеров).  
- Закрытие отдельных ордеров вручную не предусмотрено.  

### 4.4. Настройки доливок  
- В интерфейсе можно задать цену и объём доливки.  
- Галочка отвечает за включение/отключение доливки после TP1.

### 4.5. Глобальный контроль  
- Кнопки: «Запустить все» и «Остановить все».  
- Управление также доступно для каждого инструмента отдельно.  

---

## 5. Как выглядит весь процесс работы:
- Пользователь заходит в программу
- Жмёт на добавления инструмента
- Вводит инструмент (произвольный, не заданный программой)
- Настраивает все параметры и нажимает на запуск
- Далее сначала у нас выставляются 2 условных ордера, которые отвечают за открытие позиции
- Далее скрипт мониторит момент, когда они исполнятся
- После исполнения этих ордеров выставляются стоп лоссы и тейк профиты
- Далее у нас скрипт мониторит момент, когда сработает первый тейк профит (не важно чего, шорта или лонга)
- После срабатывания тп если у пользователя в настройках стояла доливка, то выставляется доп ордер на доливку
- Ну и дальше в целом всё по тз
